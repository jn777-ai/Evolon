<th:block xmlns:th="http://www.thymeleaf.org"
          th:replace="~{layout/layout :: layout(
            title='Evolon-出品管理',
            content=~{::content},
            showHeader=true,
            showFooter=true
          )}">
  <th:block th:fragment="content">

    <div class="myp-selling">

      <a th:href="@{/my-page}" class="myp-back">← マイページへ戻る</a>

      <!-- 上の説明カード -->
      <section class="panel myp-hero">
        <div class="myp-hero__left">
          <h1 class="myp-hero__title">出品管理</h1>
          <p class="myp-hero__desc">あなたが出品した商品の一覧です。</p>
        </div>

        <a th:href="@{/items/new}" class="button button--primary myp-hero__cta">
          新しい商品を出品する
        </a>
      </section>

      <!-- 一覧カード -->
      <section class="panel myp-table">
        <div class="panel-head">
          <h2 class="panel-title">出品中の商品</h2>

          <!-- ★ null安全 -->
          <span class="chip" th:text="${items == null ? 0 : #lists.size(items)} + '件'">0件</span>
        </div>

        <div class="table-wrap">
          <table class="data-table data-table--selling">
            <thead>
              <tr>
                <th class="col-img">画像</th>
                <th>商品</th>
                <th class="col-price">価格</th>
                <th class="col-status">ステータス</th>
                <th class="col-actions">操作</th>
              </tr>
            </thead>

            <tbody>
              <tr th:each="item : ${items}">
                <td class="col-img">
                  <img class="thumb"
                       th:src="${item.imageUrl != null ? item.imageUrl : '/images/placeholder.png'}"
                       alt="商品画像">
                </td>

                <td class="cell-title">
                  <a class="title-link" th:href="@{/items/{id}(id=${item.id})}" th:text="${item.name}">商品名</a>
                </td>

                <td class="col-price"
                    th:text="'¥' + ${#numbers.formatDecimal(item.price,0,'COMMA',0,'POINT')}">¥0</td>

                <td class="col-status">
                  <span class="status-pill"
                        th:classappend="${item.status != null and item.status.name() == 'SOLD' ? ' is-sold' : ' is-selling'}"
                        th:text="${item.status != null ? item.status.label : '—'}">出品中</span>
                </td>

                <td class="col-actions">
                  <a th:href="@{/items/{id}/edit(id=${item.id})}" class="btn-mini">編集</a>

                  <form th:action="@{/items/{id}/delete(id=${item.id})}" method="post" class="inline-form">
                    <button type="submit" class="btn-mini btn-mini--danger"
                            onclick="return confirm('本当にこの商品を削除しますか？');">
                      削除
                    </button>
                  </form>
                </td>
              </tr>

              <!-- ★ null安全 -->
              <tr th:if="${items == null or #lists.isEmpty(items)}">
                <td colspan="5" class="empty-row">出品中の商品はありません。</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

    </div>

  </th:block>
</th:block>
