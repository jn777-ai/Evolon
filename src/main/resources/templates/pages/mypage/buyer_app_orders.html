<th:block xmlns:th="http://www.thymeleaf.org"
          th:replace="~{layout/layout :: layout(
            title='Evolon-購入一覧',
            content=~{::content},
            showHeader=true,
            showFooter=true
          )}">
  <th:block th:fragment="content">

    <div class="myp-selling">

      <a th:href="@{/my-page}" class="myp-back">← マイページへ戻る</a>

      <!-- 上の説明カード（出品管理と同型） -->
      <section class="panel myp-hero">
        <div class="myp-hero__left">
          <h1 class="myp-hero__title">購入履歴</h1>
          <p class="myp-hero__desc">あなたが購入した商品の一覧です。</p>
        </div>

        <a th:href="@{/items}" class="button button--primary myp-hero__cta">
          商品一覧へ
        </a>
      </section>

      <!-- 一覧カード（出品管理と同型） -->
      <section class="panel myp-table">
        <div class="panel-head">
          <h2 class="panel-title">購入した商品</h2>
          <span class="chip"
                th:text="${myOrders != null ? #lists.size(myOrders) : 0} + '件'">0件</span>
        </div>

        <div class="table-wrap">
          <table class="data-table data-table--orders">
            <thead>
              <tr>
                <th class="col-img">画像</th>
                <th>商品</th>
                <th>出品者</th>
                <th class="col-price">価格</th>
                <th class="col-status">ステータス</th>
                <th class="col-actions">操作</th>
              </tr>
            </thead>

            <tbody>
              <tr th:each="order : ${myOrders}">
                <!-- 画像（出品管理と同じ thumb 運用） -->
                <td class="col-img">
                  <img class="thumb"
                       th:src="${(order.item != null and order.item.imageUrl != null) ? order.item.imageUrl : '/images/placeholder.png'}"
                       alt="商品画像">
                </td>

                <!-- 商品名（出品管理と同じ title-link） -->
                <td class="cell-title">
                  <a class="title-link"
                     th:href="@{/orders/{id}(id=${order.id})}"
                     th:text="${order.item != null ? order.item.name : '（商品なし）'}">商品名</a>
                </td>

                <!-- 出品者：nickname優先（既存ロジックそのまま） -->
                <td th:text="${(order.item != null and order.item.seller != null)
                               ? ((order.item.seller.nickname != null and !#strings.isEmpty(order.item.seller.nickname))
                                  ? order.item.seller.nickname
                                  : order.item.seller.name)
                               : '—'}">出品者</td>

                <td class="col-price"
                    th:text="'¥' + ${#numbers.formatDecimal(order.price, 0, 'COMMA', 0, 'POINT')}">¥0</td>

                <td class="col-status">
                  <span class="status-pill"
                        th:classappend="${order.orderStatus != null and order.orderStatus.name() == 'COMPLETED'}
                                        ? ' is-sold' : ' is-selling'"
                        th:text="${order.orderStatus != null ? order.orderStatus.label : '—'}">取引中</span>
                </td>

                <!-- 操作：出品管理と同じ btn-mini に統一 -->
                <td class="col-actions">
                  <a th:href="@{/orders/{id}(id=${order.id})}" class="btn-mini">取引詳細</a>
                </td>
              </tr>

              <tr th:if="${myOrders == null or #lists.isEmpty(myOrders)}">
                <td colspan="6" class="empty-row">購入した商品はありません。</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

    </div>

  </th:block>
</th:block>
