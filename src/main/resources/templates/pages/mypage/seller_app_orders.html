<!DOCTYPE html>
<html lang="ja"
      xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Evolon-販売履歴</title>
</head>

<body>

<th:block th:replace="~{layout/layout :: layout(
        title='Evolon-販売履歴',
        content=~{::content},
        showHeader=true,
        showFooter=true
)}">

  <th:block th:fragment="content">

    <div class="myp-selling">

      <a th:href="@{/my-page}" class="myp-back">← マイページへ戻る</a>

      <!-- 上の説明カード -->
      <section class="panel myp-hero">
        <div class="myp-hero__left">
          <h1 class="myp-hero__title">販売履歴</h1>
          <p class="myp-hero__desc">あなたが販売した商品の一覧です。</p>
        </div>

        <a th:href="@{/items}" class="button button--primary myp-hero__cta">
          商品一覧へ
        </a>
      </section>

      <!-- 一覧カード -->
      <section class="panel myp-table">
        <div class="panel-head">
          <h2 class="panel-title">売れた商品</h2>

          <!-- 件数：null安全 -->
          <span class="chip"
                th:text="${mySales == null ? 0 : #lists.size(mySales)} + '件'">0件</span>
        </div>

        <div class="table-wrap">
          <table class="data-table data-table--sales">
            <thead>
              <tr>
                <th class="col-img">画像</th>
                <th>商品</th>
                <th>購入者</th>
                <th class="col-price">価格</th>
                <th class="col-status">ステータス</th>
                <th class="col-actions">操作</th>
              </tr>
            </thead>

            <tbody>
              <!-- 一覧 -->
              <tr th:each="order : ${mySales}">
                <!-- 画像 -->
                <td class="col-img">
                  <img class="thumb"
                       th:src="${(order.item != null and order.item.imageUrl != null)
                                ? order.item.imageUrl
                                : '/images/placeholder.png'}"
                       alt="商品画像" />
                </td>

                <!-- 商品名 -->
                <td class="cell-title">
                  <a class="title-link"
                     th:href="@{/orders/{id}(id=${order.id})}"
                     th:text="${order.item != null ? order.item.name : '（商品なし）'}">
                    商品名
                  </a>
                </td>

                <!-- 購入者：nickname優先 -->
                <td th:text="${order.buyer != null
                              ? ((order.buyer.nickname != null and !#strings.isEmpty(order.buyer.nickname))
                                  ? order.buyer.nickname
                                  : order.buyer.name)
                              : '—'}">
                  購入者
                </td>

                <!-- 価格 -->
                <td class="col-price"
                    th:text="'¥' + ${#numbers.formatDecimal(order.price, 0, 'COMMA', 0, 'POINT')}">
                  ¥0
                </td>

                <!-- ステータス -->
                <td class="col-status">
                  <span class="status-pill"
                        th:classappend="${order.orderStatus != null and order.orderStatus.name() == 'COMPLETED'}
                                        ? ' is-sold'
                                        : ' is-selling'"
                        th:text="${order.orderStatus != null ? order.orderStatus.label : '—'}">
                    ステータス
                  </span>
                </td>

                <!-- 操作 -->
                <td class="col-actions">
                  <a th:href="@{/orders/{id}(id=${order.id})}" class="btn-mini">取引詳細</a>
                </td>
              </tr>

              <!-- 空表示：mySalesがnull or empty -->
              <tr th:if="${mySales == null or #lists.isEmpty(mySales)}">
                <td colspan="6" class="empty-row">販売した商品はありません。</td>
              </tr>

            </tbody>
          </table>
        </div>

      </section>

    </div>

  </th:block>

</th:block>

</body>
</html>
